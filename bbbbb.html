<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Milagro</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/minilogo.png" rel="icon">
  <link href="assets/img/minilogo.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Active
  * Template URL: https://bootstrapmade.com/active-bootstrap-website-template/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="cards-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/minilogo.png" alt=""> -->
      <img src="assets/img/Milagro.png"  alt="Milagro Logo" class="logo-img"> 
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Inicio</a></li>
          <li><a href="about.html">Nosotros</a></li>
          <li><a href="services.html">Productos</a></li>
          <li><a href="login.html">login</a></li>
          <li><a href="contact.html">Contactanos</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

<div class="container">
    <header>
        <h1>Generador de banners</h1>
        <p>Crea los banners de los productos y sus descripciones que se pueden mostrar/ocultar</p>
    </header>
    
    <div class="controls">
        <div class="form-group">
            <label for="imageUpload">Seleccionar imagen local:</label>
            <div class="file-input-container">
                <input type="file" id="imageUpload" class="file-input" accept="image/*" aria-label="Seleccionar imagen local">
                <label for="imageUpload" class="file-input-label">Elegir imagen</label>
            </div>
            <img id="imagePreview" class="image-preview" alt="Vista previa" style="display:none;max-width:100%;height:auto;">
        </div>
        
        <div class="form-group">
            <label for="cardTitle">Título de la card:</label>
            <input type="text" id="cardTitle" placeholder="Ingresa un título (incluye 'bolso' o 'canasta')" aria-label="Título de la card">
        </div>
        
        <div class="form-group">
            <label for="cardText">Texto de la card (con saltos de línea):</label>
            <textarea id="cardText" placeholder="Ingresa el texto descriptivo. Usa &lt;br&gt; para saltos de línea" aria-label="Texto de la card" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label for="cardCategory">Categoría:</label>
            <select id="cardCategory" aria-label="Categoría de la card">
                <option value="">Selecciona una categoría</option>
                <option value="bolsos">Bolsos</option>
                <option value="canastas">Canastas</option>
            </select>
        </div>
        
        <div id="formErrorMsg" class="error-message" style="display:none;"></div>
        
        <div class="button-group">
            <button class="btn-generate" onclick="generateCard()">Generar Card</button>
            <button class="btn-clear" onclick="clearAllCards()">Limpiar Todo</button>
            <button class="btn-view-bolsos" onclick="viewBolsos()">Ver Bolsos</button>
            <button class="btn-view-canastas" onclick="viewCanastas()">Ver Canastas</button>
        </div>
    </div>
    
    <div id="cardsContainer" class="cards-container">
        <div class="empty-state">
            <h3>No hay cards aún</h3>
            <p>Agrega tu primera card usando el formulario superior</p>
        </div>
    </div>
</div>

<script>
// Claves para localStorage
const STORAGE_KEY_BOLSOS = 'savedCardsBolsos';
const STORAGE_KEY_CANASTAS = 'savedCardsCanastas';

// Cargar cards al iniciar la página
document.addEventListener('DOMContentLoaded', function() {
    loadAllCards();
});

// Función para determinar categoría basada en título
function getCategoryFromTitle(title) {
    const titleLower = title.toLowerCase();
    if (titleLower.includes('bolso') || titleLower.includes('bolsa') || titleLower.includes('mochila')) {
        return 'bolsos';
    } else if (titleLower.includes('canasta') || titleLower.includes('cesta') || titleLower.includes('canastro')) {
        return 'canastas';
    }
    return 'otros';
}

// Función para guardar cards en localStorage según categoría
function saveCardsToStorage() {
    const bolsos = [];
    const canastas = [];
    
    document.querySelectorAll('.card').forEach(card => {
        const category = card.getAttribute('data-category');
        const cardData = {
            title: card.querySelector('.card-title').textContent,
            text: card.querySelector('.card-text').innerHTML,
            image: card.querySelector('.card-image') ? card.querySelector('.card-image').src : null,
            category: category
        };
        
        if (category === 'bolsos') {
            bolsos.push(cardData);
        } else if (category === 'canastas') {
            canastas.push(cardData);
        }
    });
    
    localStorage.setItem(STORAGE_KEY_BOLSOS, JSON.stringify(bolsos));
    localStorage.setItem(STORAGE_KEY_CANASTAS, JSON.stringify(canastas));
}

// Función para cargar todas las cards
function loadAllCards() {
    const bolsos = JSON.parse(localStorage.getItem(STORAGE_KEY_BOLSOS) || '[]');
    const canastas = JSON.parse(localStorage.getItem(STORAGE_KEY_CANASTAS) || '[]');
    const allCards = [...bolsos, ...canastas];
    
    const cardsContainer = document.getElementById('cardsContainer');
    const emptyState = document.querySelector('.empty-state');
    
    if (allCards.length > 0) {
        emptyState.style.display = 'none';
        
        allCards.forEach(cardData => {
            const card = createCardElement(cardData);
            cardsContainer.appendChild(card);
        });
    }
}

// Función para crear elemento card
function createCardElement(cardData) {
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-category', cardData.category);
    
    const categoryBadge = cardData.category === 'bolsos' ? 
        '<span class="category-badge bolsos-badge">Bolsos</span>' : 
        '<span class="category-badge canastas-badge">Canastas</span>';
    
    card.innerHTML = `
        ${categoryBadge}
        ${cardData.image ? `<img src="${cardData.image}" alt="${cardData.title}" class="card-image">` : ''}
        <h3 class="card-title">${cardData.title}</h3>
        <div class="card-text">${cardData.text}</div>
        <button class="btn-delete" onclick="deleteCard(this)">Eliminar</button>
    `;
    return card;
}

function generateCard() {
    const title = document.getElementById('cardTitle').value.trim();
    const text = document.getElementById('cardText').value.trim();
    const categorySelect = document.getElementById('cardCategory').value;
    const imagePreview = document.getElementById('imagePreview');
    const errorMsg = document.getElementById('formErrorMsg');
    
    // Validación
    if (!title || !text || !categorySelect) {
        errorMsg.textContent = 'Por favor, completa todos los campos obligatorios';
        errorMsg.style.display = 'block';
        return;
    }
    
    errorMsg.style.display = 'none';
    
    // Determinar categoría (prioridad al selector, luego al título)
    let category = categorySelect;
    if (!category) {
        category = getCategoryFromTitle(title);
    }
    
    // Crear objeto card
    const cardData = {
        title: title,
        text: text.replace(/\n/g, '<br>'),
        image: imagePreview.style.display !== 'none' ? imagePreview.src : null,
        category: category
    };
    
    // Crear y agregar card
    const card = createCardElement(cardData);
    const cardsContainer = document.getElementById('cardsContainer');
    const emptyState = document.querySelector('.empty-state');
    
    emptyState.style.display = 'none';
    cardsContainer.appendChild(card);
    
    // Guardar en localStorage
    saveCardsToStorage();
    
    // Limpiar formulario
    clearForm();
}

function deleteCard(button) {
    const card = button.parentElement;
    card.remove();
    
    // Actualizar localStorage
    saveCardsToStorage();
    
    // Mostrar estado vacío si no hay cards
    checkEmptyState();
}

function clearAllCards() {
    if (confirm('¿Estás seguro de que quieres eliminar todas las cards?')) {
        const cardsContainer = document.getElementById('cardsContainer');
        cardsContainer.innerHTML = `
            <div class="empty-state">
                <h3>No hay cards aún</h3>
                <p>Agrega tu primera card usando el formulario superior</p>
            </div>
        `;
        
        // Limpiar localStorage
        localStorage.removeItem(STORAGE_KEY_BOLSOS);
        localStorage.removeItem(STORAGE_KEY_CANASTAS);
        clearForm();
    }
}

function viewBolsos() {
    // Guardar en sessionStorage qué categoría queremos ver
    sessionStorage.setItem('viewCategory', 'bolsos');
    window.location.href = 'bolsos.html';
}

function viewCanastas() {
    // Guardar en sessionStorage qué categoría queremos ver
    sessionStorage.setItem('viewCategory', 'canastas');
    window.location.href = 'canastas.html';
}

function checkEmptyState() {
    const cards = document.querySelectorAll('.card');
    const emptyState = document.querySelector('.empty-state');
    if (cards.length === 0) {
        emptyState.style.display = 'block';
    }
}

function clearForm() {
    document.getElementById('cardTitle').value = '';
    document.getElementById('cardText').value = '';
    document.getElementById('cardCategory').value = '';
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('imagePreview').src = '';
    document.getElementById('imageUpload').value = '';
    document.getElementById('formErrorMsg').style.display = 'none';
}

// Manejo de la imagen
document.getElementById('imageUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('imagePreview');
    
    if (file) {
        if (!file.type.startsWith('image/')) {
            alert('Por favor, selecciona un archivo de imagen válido');
            this.value = '';
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('La imagen no debe superar los 5MB');
            this.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
});
</script>

<style>
.error-message {
    color: red;
    margin-bottom: 10px;
    padding: 8px;
    background: #ffe6e6;
    border-radius: 4px;
}
</style>

 <footer id="footer" class="footer light-background">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-6 col-lg-3 mb-3 mb-md-0">
          <div class="widget">
            <h3 class="widget-heading">Milagro</h3>
            <p class="mb-4">
Es un emprendimiento hecho a mano, pensado para decorar tu hogar de una manera fresca y unica con diseños exclusivos,que daran una unica e innovadora a cualquier ambientede tu hogar.
            </p>
            <p class="mb-0">
              <a href="about.html" class="btn-learn-more">Nosotros</a>
            </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 ps-lg-5 mb-3 mb-md-0">
          <div class="widget">
            <h3 class="widget-heading">Navigacion</h3>
            <ul class="list-unstyled float-start me-5">
              <li><a href="index.html">Inicio</a></li>
              <li><a href="about.html">sobre nosotros</a></li>
            </ul>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 pl-lg-5">
          <div class="widget">
            <h3 class="widget-heading">Contactanos</h3>
            <ul class="list-unstyled social-icons light mb-3">
              <li>
                <a href="#"><span class="bi bi-facebook"></span></a>
              </li>
              <li>
                <a href="https://www.instagram.com/mila.groofficial/"><span class="bi bi-instagram"></span></a>
              </li>
              <li>
                <a href="https://wa.link/ynsrfl"><span class="bi bi-whatsapp"></span></a>
            </ul>
          </div>
        </div>
      </div>

      <div class="copyright d-flex flex-column flex-md-row align-items-center justify-content-md-between">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">Milagro.</strong> <span>All Rights Reserved</span></p>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <!-- Lógica de creación de cards para bbbbb.html -->
  <script>
    // State
    let selectedImageUrl = null;
    let cardCounter = 0;
    let editingCardId = null;

    // Protección de acceso: solo usuario logueado
    if (localStorage.getItem('milagro_logged') !== 'true') {
      window.location.href = 'login.html';
    }

    // Utilities
    function removeAllDuplicatesLS(tipo) {
      let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
      const uniqueCards = [];
      const ids = new Set();
      cards.forEach(card => {
        if (!ids.has(card.id)) {
          uniqueCards.push(card);
          ids.add(card.id);
        }
      });
      localStorage.setItem('cards_' + tipo, JSON.stringify(uniqueCards));
    }

    function formatDescription(text) {
      return (text || '').replace(/\n/g, '<br>');
    }

    // Render stored cards from localStorage into the container
    function renderStoredCards() {
      const container = document.getElementById('cardsContainer');
      const emptyState = document.querySelector('.empty-state');
      // Clear existing product cards (keep empty-state element)
      container.querySelectorAll('.card').forEach(card => card.remove());

      let total = 0;
      ['bolsos', 'canastas'].forEach(tipo => {
        const cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        cards.forEach(card => {
          createCardElement(card.img, card.titulo, card.desc, card.id, tipo);
          total++;
        });
      });

      if (emptyState) emptyState.style.display = total > 0 ? 'none' : 'block';
    }

    // DOMContent loaded: cleanup, listeners, initial render
    document.addEventListener('DOMContentLoaded', function() {
      removeAllDuplicatesLS('bolsos');
      removeAllDuplicatesLS('canastas');

      window.addEventListener('storage', function(e) {
        if (e.key === 'cards_bolsos' || e.key === 'cards_canastas') {
          renderStoredCards();
        }
      });

      renderStoredCards();

      const input = document.getElementById('imageUpload');
      if (input) input.addEventListener('change', handleImageUpload);

      const preloader = document.getElementById('preloader');
      if (preloader) preloader.style.display = 'none';
    });

    // Image upload handler
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      if (!file.type.match('image.*')) {
        alert('Por favor, selecciona solo archivos de imagen.');
        event.target.value = '';
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        alert('La imagen no debe superar los 5MB');
        event.target.value = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        selectedImageUrl = e.target.result;
        const preview = document.getElementById('imagePreview');
        if (preview) {
          preview.src = selectedImageUrl;
          preview.style.display = 'block';
          preview.alt = 'Vista previa de la imagen';
        }
      };
      reader.readAsDataURL(file);
    }

    // Create or update a card
    window.generateCard = function() {
      const title = document.getElementById('cardTitle').value.trim();
      const text = document.getElementById('cardText').value.trim();
      const image = selectedImageUrl;
      const errorMsg = document.getElementById('formErrorMsg');

      if (!title || !text) {
        errorMsg.textContent = 'Por favor, completa todos los campos obligatorios';
        errorMsg.style.display = 'block';
        return;
      }
      // For create, require image as well
      if (!editingCardId && !image) {
        errorMsg.textContent = 'Por favor, selecciona una imagen.';
        errorMsg.style.display = 'block';
        return;
      }
      errorMsg.style.display = 'none';

      // Determine type by title if possible
      let tipo = '';
      if (/bolso|bolsos|bolsa|mochila/i.test(title)) tipo = 'bolsos';
      else if (/canasta|canastas|cesta/i.test(title)) tipo = 'canastas';

      // If editing, update existing
      if (editingCardId) {
        if (tipo) {
          let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
          const idx = cards.findIndex(c => c.id === editingCardId);
          if (idx !== -1) {
            cards[idx] = { id: editingCardId, img: image || cards[idx].img, titulo: title, desc: text };
            localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
          } else {
            // If not found in inferred tipo, try both lists
            ['bolsos', 'canastas'].forEach(t => {
              let list = JSON.parse(localStorage.getItem('cards_' + t) || '[]');
              const j = list.findIndex(c => c.id === editingCardId);
              if (j !== -1) {
                list[j] = { id: editingCardId, img: image || list[j].img, titulo: title, desc: text };
                localStorage.setItem('cards_' + t, JSON.stringify(list));
              }
            });
          }
        }
        editingCardId = null;
        document.querySelector('.btn-generate').textContent = 'Generar Card';
        renderStoredCards();
        resetForm();
        return;
      }

      // Create new card
      const cardId = 'card-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
      const nuevaCard = { id: cardId, img: image, titulo: title, desc: text };
      if (tipo) {
        let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        cards.push(nuevaCard);
        localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
      } else {
        // If no type inferred, default to bolsos
        let cards = JSON.parse(localStorage.getItem('cards_bolsos') || '[]');
        cards.push(nuevaCard);
        localStorage.setItem('cards_bolsos', JSON.stringify(cards));
      }

      renderStoredCards();
      resetForm();
    };

    // Create DOM element and append to container
    function createCardElement(imageUrl, title, text, id, tipo) {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-card-id', id);
      if (tipo) card.setAttribute('data-category', tipo);
      card.innerHTML = `
        ${imageUrl ? `<img src="${imageUrl}" alt="${title}" class="card-image">` : ''}
        <div class="card-content">
          <h3 class="card-title">${title}</h3>
          <button class="boton" onclick="document.getElementById('desc-${id}').classList.toggle('d-none')">Ver descripción</button>
          <button class="boton btn-editar" onclick="window.editCard('${id}')">Editar</button>
          <button class="boton btn-delete" onclick="window.deleteCard('${id}')" title="Eliminar"><i class="bi bi-trash" style="font-size:1.2em;color:#d9534f;"></i></button>
          <div id="desc-${id}" class="card-desc d-none">
            ${formatDescription(text)}
          </div>
        </div>
      `;
      document.getElementById('cardsContainer').appendChild(card);
    }

    window.deleteCard = function(cardId) {
      if (!confirm('¿Seguro que quieres eliminar esta card?')) return;
      // Remove from DOM
      const cardElem = document.querySelector(`.card[data-card-id='${cardId}']`);
      if (cardElem) cardElem.remove();
      // Remove from storage (both types)
      ['bolsos', 'canastas'].forEach(tipo => {
        let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        cards = cards.filter(c => c.id !== cardId);
        localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
      });
      renderStoredCards();
    };

    window.editCard = function(cardId) {
      // Find card in storage first
      let found = null;
      ['bolsos', 'canastas'].forEach(tipo => {
        if (found) return;
        const cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        const c = cards.find(x => x.id === cardId);
        if (c) found = c;
      });
      // Fallback: try DOM
      if (!found) {
        const card = document.querySelector(`.card[data-card-id='${cardId}']`);
        if (card) {
          found = {
            id: cardId,
            img: card.querySelector('img') ? card.querySelector('img').src : null,
            titulo: card.querySelector('.card-title') ? card.querySelector('.card-title').textContent : '',
            desc: card.querySelector('.card-desc') ? card.querySelector('.card-desc').innerHTML.replace(/<br>/g, '\n') : ''
          };
        }
      }
      if (!found) return;
      document.getElementById('cardTitle').value = found.titulo || '';
      document.getElementById('cardText').value = found.desc ? found.desc.replace(/<br>/g, '\n') : '';
      const preview = document.getElementById('imagePreview');
      if (preview && found.img) {
        preview.src = found.img;
        preview.style.display = 'block';
      }
      selectedImageUrl = found.img || null;
      editingCardId = cardId;
      const btn = document.querySelector('.btn-generate');
      if (btn) btn.textContent = 'Guardar Cambios';
    };

    window.clearAllCards = function() {
      if (!confirm('¿Estás seguro de que quieres eliminar todas las cards?')) return;
      localStorage.removeItem('cards_bolsos');
      localStorage.removeItem('cards_canastas');
      const container = document.getElementById('cardsContainer');
      container.innerHTML = `
        <div class="empty-state">
          <h3>No hay cards aún</h3>
          <p>Agrega tu primera card usando el formulario superior</p>
        </div>
      `;
      cardCounter = 0;
      document.getElementById('formErrorMsg').style.display = 'none';
    };

    function resetForm() {
      const title = document.getElementById('cardTitle');
      const text = document.getElementById('cardText');
      const upload = document.getElementById('imageUpload');
      if (title) title.value = '';
      if (text) text.value = '';
      if (upload) upload.value = '';
      const preview = document.getElementById('imagePreview');
      if (preview) {
        preview.src = '';
        preview.style.display = 'none';
      }
      selectedImageUrl = null;
      editingCardId = null;
      const btn = document.querySelector('.btn-generate');
      if (btn) btn.textContent = 'Generar Card';
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) preloader.style.display = 'none';
    });
  </script>
    
</body>

</html>