<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Milagro</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/minilogo.png" rel="icon">
  <link href="assets/img/minilogo.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Active
  * Template URL: https://bootstrapmade.com/active-bootstrap-website-template/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="cards-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/minilogo.png" alt=""> -->
      <img src="assets/img/Milagro.png"  alt="Milagro Logo" class="logo-img"> 
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Inicio</a></li>
          <li><a href="about.html">Nosotros</a></li>
          <li><a href="services.html">Productos</a></li>
          <li><a href="login.html">login</a></li>
          <li><a href="contact.html">Contactanos</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

<div class="container">
    <header>
        <h1>Generador de banners</h1>
        <p>Crea los banners de los productos y sus descripciones que se pueden mostrar/ocultar</p>
    </header>
    
    <div class="controls">
        <div class="form-group">
            <label for="imageUpload">Seleccionar imagen local:</label>
            <div class="file-input-container">
                <input type="file" id="imageUpload" class="file-input" accept="image/*" aria-label="Seleccionar imagen local">
                <label for="imageUpload" class="file-input-label">Elegir imagen</label>
            </div>
            <img id="imagePreview" class="image-preview" alt="Vista previa" style="display:none;max-width:100%;height:auto;">
        </div>
        
        <div class="form-group">
            <label for="cardTitle">Título de la card:</label>
            <input type="text" id="cardTitle" placeholder="Ingresa un título (incluye 'bolso' o 'canasta')" aria-label="Título de la card">
        </div>
        
        <div class="form-group">
            <label for="cardText">Texto de la card (con saltos de línea):</label>
            <textarea id="cardText" placeholder="Ingresa el texto descriptivo. Usa &lt;br&gt; para saltos de línea" aria-label="Texto de la card" rows="4"></textarea>
        </div>

        <div class="form-group">
            <label for="cardCategory">Categoría:</label>
            <select id="cardCategory" aria-label="Categoría de la card">
                <option value="">Selecciona una categoría</option>
                <option value="bolsos">Bolsos</option>
                <option value="canastas">Canastas</option>
            </select>
        </div>
        
        <div id="formErrorMsg" class="error-message" style="display:none;"></div>
        
        <div class="button-group">
            <button class="btn-generate" onclick="generateCard()">Generar Card</button>
            <button class="btn-clear" onclick="clearAllCards()">Limpiar Todo</button>
          <button class="btn-publish" onclick="publishCardToFirebase()">Publicar en la nube</button>
            <button class="btn-view-bolsos" onclick="viewBolsos()">Ver Bolsos</button>
            <button class="btn-view-canastas" onclick="viewCanastas()">Ver Canastas</button>
        </div>
    </div>
    
    <div id="cardsContainer" class="cards-container">
        <div class="empty-state">
            <h3>No hay cards aún</h3>
            <p>Agrega tu primera card usando el formulario superior</p>
        </div>
    </div>
</div>



 <footer id="footer" class="footer light-background">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-6 col-lg-3 mb-3 mb-md-0">
          <div class="widget">
            <h3 class="widget-heading">Milagro</h3>
            <p class="mb-4">
Es un emprendimiento hecho a mano, pensado para decorar tu hogar de una manera fresca y unica con diseños exclusivos,que daran una unica e innovadora a cualquier ambientede tu hogar.
            </p>
            <p class="mb-0">
              <a href="about.html" class="btn-learn-more">Nosotros</a>
            </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 ps-lg-5 mb-3 mb-md-0">
          <div class="widget">
            <h3 class="widget-heading">Navigacion</h3>
            <ul class="list-unstyled float-start me-5">
              <li><a href="index.html">Inicio</a></li>
              <li><a href="about.html">sobre nosotros</a></li>
            </ul>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 pl-lg-5">
          <div class="widget">
            <h3 class="widget-heading">Contactanos</h3>
            <ul class="list-unstyled social-icons light mb-3">
              <li>
                <a href="#"><span class="bi bi-facebook"></span></a>
              </li>
              <li>
                <a href="https://www.instagram.com/mila.groofficial/"><span class="bi bi-instagram"></span></a>
              </li>
              <li>
                <a href="https://wa.link/ynsrfl"><span class="bi bi-whatsapp"></span></a>
            </ul>
          </div>
        </div>
      </div>

      <div class="copyright d-flex flex-column flex-md-row align-items-center justify-content-md-between">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">Milagro.</strong> <span>All Rights Reserved</span></p>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <!-- Firebase config (paste your config here) -->
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyCwmZknjZhJLyrl6XtaJKu_q9IL1f9v3tM",
      authDomain: "milagro-53c93.firebaseapp.com",
      projectId: "milagro-53c93",
      storageBucket: "milagro-53c93.firebasestorage.app",
      messagingSenderId: "899696918093",
      appId: "1:899696918093:web:ccf853e2c1406b52cfe604",
      measurementId: "G-SYV6TMR5RB"
    };
  </script>
  <!-- Firebase SDKs (optional) - paste your firebase config into window.FIREBASE_CONFIG -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <!-- Lógica de creación de cards para bbbbb.html -->
  <script>
    // State
    let selectedImageUrl = null;
    let cardCounter = 0;
    let editingCardId = null;

    // Protección de acceso: solo usuario logueado
    if (localStorage.getItem('milagro_logged') !== 'true') {
      window.location.href = 'login.html';
    }

    // Utilities
    function removeAllDuplicatesLS(tipo) {
      let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
      const uniqueCards = [];
      const ids = new Set();
      cards.forEach(card => {
        if (!ids.has(card.id)) {
          uniqueCards.push(card);
          ids.add(card.id);
        }
      });
      localStorage.setItem('cards_' + tipo, JSON.stringify(uniqueCards));
    }

    function formatDescription(text) {
      return (text || '').replace(/\n/g, '<br>');
    }

    // Render stored cards from localStorage into the container
    function renderStoredCards() {
      const container = document.getElementById('cardsContainer');
      const emptyState = document.querySelector('.empty-state');
      // Clear existing product cards (keep empty-state element)
      container.querySelectorAll('.card').forEach(card => card.remove());

      // Read both internal (cards_*) and compatibility (savedCards*) keys
      const cardsBol = JSON.parse(localStorage.getItem('cards_bolsos') || '[]');
      const savedBol = JSON.parse(localStorage.getItem('savedCardsBolsos') || '[]');
      const cardsCan = JSON.parse(localStorage.getItem('cards_canastas') || '[]');
      const savedCan = JSON.parse(localStorage.getItem('savedCardsCanastas') || '[]');

      // Normalize into common shape
      const normalizeFromCards = (c) => ({ id: c.id, img: c.img, titulo: c.titulo, desc: c.desc, tipo: 'bolsos' });
      const normalizeFromSaved = (c, tipo) => ({ id: c.id || (c.title ? (c.title + '|' + (c.image || '')) : ('saved-' + Math.random())), img: c.image || c.img || null, titulo: c.title || c.titulo || '', desc: c.text || c.desc || '', tipo: tipo });

      const combined = [];
      cardsBol.forEach(c => combined.push({ id: c.id, img: c.img, titulo: c.titulo, desc: c.desc, tipo: 'bolsos' }));
      savedBol.forEach(c => combined.push(normalizeFromSaved(c, 'bolsos')));
      cardsCan.forEach(c => combined.push({ id: c.id, img: c.img, titulo: c.titulo, desc: c.desc, tipo: 'canastas' }));
      savedCan.forEach(c => combined.push(normalizeFromSaved(c, 'canastas')));

      // Deduplicate by id (prefer cards_* entries over saved ones)
      const seen = new Set();
      let total = 0;
      combined.forEach(item => {
        const key = item.id || (item.titulo + '|' + (item.img || ''));
        if (!seen.has(key)) {
          seen.add(key);
          createCardElement(item.img, item.titulo, item.desc, item.id || key, item.tipo);
          total++;
        }
      });

      if (emptyState) emptyState.style.display = total > 0 ? 'none' : 'block';
    }

    // Keep compatibility keys (savedCardsBolsos / savedCardsCanastas) in sync with internal cards_* format
    function syncSavedFromCards() {
      ['bolsos', 'canastas'].forEach(tipo => {
        const cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        const mapped = cards.map(c => ({ title: c.titulo || '', text: c.desc || '', image: c.img || c.image || null }));
        if (tipo === 'bolsos') localStorage.setItem('savedCardsBolsos', JSON.stringify(mapped));
        if (tipo === 'canastas') localStorage.setItem('savedCardsCanastas', JSON.stringify(mapped));
      });
    }

    // DOMContent loaded: cleanup, listeners, initial render
    document.addEventListener('DOMContentLoaded', function() {
      removeAllDuplicatesLS('bolsos');
      removeAllDuplicatesLS('canastas');

      window.addEventListener('storage', function(e) {
        if (e.key === 'cards_bolsos' || e.key === 'cards_canastas') {
          renderStoredCards();
        }
      });

      renderStoredCards();

      const input = document.getElementById('imageUpload');
      if (input) input.addEventListener('change', handleImageUpload);

      const preloader = document.getElementById('preloader');
      if (preloader) preloader.style.display = 'none';
    });

    // Image upload handler
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      if (!file.type.match('image.*')) {
        alert('Por favor, selecciona solo archivos de imagen.');
        event.target.value = '';
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        alert('La imagen no debe superar los 5MB');
        event.target.value = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        selectedImageUrl = e.target.result;
        const preview = document.getElementById('imagePreview');
        if (preview) {
          preview.src = selectedImageUrl;
          preview.style.display = 'block';
          preview.alt = 'Vista previa de la imagen';
        }
      };
      reader.readAsDataURL(file);
    }

    // Create or update a card
    window.generateCard = function() {
      const title = document.getElementById('cardTitle').value.trim();
      const text = document.getElementById('cardText').value.trim();
      const image = selectedImageUrl;
      const errorMsg = document.getElementById('formErrorMsg');

      if (!title || !text) {
        errorMsg.textContent = 'Por favor, completa todos los campos obligatorios';
        errorMsg.style.display = 'block';
        return;
      }
      // For create, require image as well
      if (!editingCardId && !image) {
        errorMsg.textContent = 'Por favor, selecciona una imagen.';
        errorMsg.style.display = 'block';
        return;
      }
      errorMsg.style.display = 'none';

      // Determine type by title if possible
      let tipo = '';
      if (/bolso|bolsos|bolsa|mochila/i.test(title)) tipo = 'bolsos';
      else if (/canasta|canastas|cesta/i.test(title)) tipo = 'canastas';

      // If editing, update existing
  if (editingCardId) {
        if (tipo) {
          let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
          const idx = cards.findIndex(c => c.id === editingCardId);
          if (idx !== -1) {
            cards[idx] = { id: editingCardId, img: image || cards[idx].img, titulo: title, desc: text };
            localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
            syncSavedFromCards();
          } else {
            // If not found in inferred tipo, try both lists
            ['bolsos', 'canastas'].forEach(t => {
              let list = JSON.parse(localStorage.getItem('cards_' + t) || '[]');
              const j = list.findIndex(c => c.id === editingCardId);
              if (j !== -1) {
                list[j] = { id: editingCardId, img: image || list[j].img, titulo: title, desc: text };
                localStorage.setItem('cards_' + t, JSON.stringify(list));
                syncSavedFromCards();
              }
            });
          }
        }
        editingCardId = null;
        document.querySelector('.btn-generate').textContent = 'Generar Card';
        renderStoredCards();
        resetForm();
        return;
      }

      // Create new card
      const cardId = 'card-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
      const nuevaCard = { id: cardId, img: image, titulo: title, desc: text };
      if (tipo) {
        let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        cards.push(nuevaCard);
        localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
      } else {
        // If no type inferred, default to bolsos
        let cards = JSON.parse(localStorage.getItem('cards_bolsos') || '[]');
        cards.push(nuevaCard);
        localStorage.setItem('cards_bolsos', JSON.stringify(cards));
      }
      // After creating, sync compatibility keys and render
      syncSavedFromCards();
      renderStoredCards();
      resetForm();
    };

    // Create DOM element and append to container
    function createCardElement(imageUrl, title, text, id, tipo) {
      const card = document.createElement('div');
      card.className = 'card';
      card.setAttribute('data-card-id', id);
      if (tipo) card.setAttribute('data-category', tipo);
      card.innerHTML = `
        ${imageUrl ? `<img src="${imageUrl}" alt="${title}" class="card-image">` : ''}
        <div class="card-content">
          <h3 class="card-title">${title}</h3>
          <button class="boton" onclick="document.getElementById('desc-${id}').classList.toggle('d-none')">Ver descripción</button>
          <button class="boton btn-editar" onclick="window.editCard('${id}')">Editar</button>
          <button class="boton btn-delete" onclick="window.deleteCard('${id}')" title="Eliminar"><i class="bi bi-trash" style="font-size:1.2em;color:#d9534f;"></i></button>
          <div id="desc-${id}" class="card-desc d-none">
            ${formatDescription(text)}
          </div>
        </div>
      `;
      document.getElementById('cardsContainer').appendChild(card);
    }

    window.deleteCard = function(cardId) {
      if (!confirm('¿Seguro que quieres eliminar esta card?')) return;
      // Remove from DOM
      const cardElem = document.querySelector(`.card[data-card-id='${cardId}']`);
      if (cardElem) cardElem.remove();
      // Remove from storage (both types)
      ['bolsos', 'canastas'].forEach(tipo => {
        let cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        cards = cards.filter(c => c.id !== cardId);
        localStorage.setItem('cards_' + tipo, JSON.stringify(cards));
      });
      syncSavedFromCards();
      renderStoredCards();
    };

    window.editCard = function(cardId) {
      // Find card in storage first
      let found = null;
      ['bolsos', 'canastas'].forEach(tipo => {
        if (found) return;
        const cards = JSON.parse(localStorage.getItem('cards_' + tipo) || '[]');
        const c = cards.find(x => x.id === cardId);
        if (c) found = c;
      });
      // Fallback: try DOM
      if (!found) {
        const card = document.querySelector(`.card[data-card-id='${cardId}']`);
        if (card) {
          found = {
            id: cardId,
            img: card.querySelector('img') ? card.querySelector('img').src : null,
            titulo: card.querySelector('.card-title') ? card.querySelector('.card-title').textContent : '',
            desc: card.querySelector('.card-desc') ? card.querySelector('.card-desc').innerHTML.replace(/<br>/g, '\n') : ''
          };
        }
      }
      if (!found) return;
      document.getElementById('cardTitle').value = found.titulo || '';
      document.getElementById('cardText').value = found.desc ? found.desc.replace(/<br>/g, '\n') : '';
      const preview = document.getElementById('imagePreview');
      if (preview && found.img) {
        preview.src = found.img;
        preview.style.display = 'block';
      }
      selectedImageUrl = found.img || null;
      editingCardId = cardId;
      const btn = document.querySelector('.btn-generate');
      if (btn) btn.textContent = 'Guardar Cambios';
    };

    window.clearAllCards = function() {
      if (!confirm('¿Estás seguro de que quieres eliminar todas las cards?')) return;
      localStorage.removeItem('cards_bolsos');
      localStorage.removeItem('cards_canastas');
      syncSavedFromCards();
      const container = document.getElementById('cardsContainer');
      container.innerHTML = `
        <div class="empty-state">
          <h3>No hay cards aún</h3>
          <p>Agrega tu primera card usando el formulario superior</p>
        </div>
      `;
      cardCounter = 0;
      document.getElementById('formErrorMsg').style.display = 'none';
    };

    function resetForm() {
      const title = document.getElementById('cardTitle');
      const text = document.getElementById('cardText');
      const upload = document.getElementById('imageUpload');
      if (title) title.value = '';
      if (text) text.value = '';
      if (upload) upload.value = '';
      const preview = document.getElementById('imagePreview');
      if (preview) {
        preview.src = '';
        preview.style.display = 'none';
      }
      selectedImageUrl = null;
      editingCardId = null;
      const btn = document.querySelector('.btn-generate');
      if (btn) btn.textContent = 'Generar Card';
    }
  </script>

  <script>
    // Firebase optional integration: provide window.FIREBASE_CONFIG in a script before this runs
    if (window.FIREBASE_CONFIG) {
      try {
        firebase.initializeApp(window.FIREBASE_CONFIG);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Upload image to Firebase Storage and create Firestore doc
        async function uploadImageAndSaveCard(file, title, desc, tipo) {
          const id = 'card-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
          const ref = storage.ref().child('cards/' + id + (file.name ? '_' + file.name : ''));
          await ref.put(file);
          const url = await ref.getDownloadURL();
          await db.collection('cards').doc(id).set({ title, desc, imageUrl: url, tipo, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
          return id;
        }

        // Expose a function to save current form to Firebase (if user wants to publish to cloud)
        window.publishCardToFirebase = async function() {
          const title = document.getElementById('cardTitle').value.trim();
          const desc = document.getElementById('cardText').value.trim();
          const tipo = document.getElementById('cardCategory').value || ( /bolso/i.test(title) ? 'bolsos' : 'canastas' );
          const fileInput = document.getElementById('imageUpload');
          if (!fileInput || !fileInput.files[0]) { alert('Selecciona una imagen antes de publicar'); return; }
          try {
            const id = await uploadImageAndSaveCard(fileInput.files[0], title, desc, tipo);
            alert('Card publicada en Firebase con id: ' + id);
          } catch (err) {
            console.error(err);
            alert('Error publicando card en Firebase: ' + err.message);
          }
        };

      } catch (err) {
        console.warn('Firebase init failed', err);
      }
    } else {
      // No Firebase config provided; no-op
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) preloader.style.display = 'none';
    });
  </script>
    
</body>

</html>